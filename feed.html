<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>kathaDragon | Feed</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #FF6B35; /* Saffron Orange */
            --bg-white: #FFFFFF;
            --bg-light: #F8F9FA;
            --text-dark: #2D3436;
            --text-light: #636E72;
            --border: #E0E0E0;
            --shadow: 0 2px 12px rgba(0,0,0,0.08);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            height: 100vh;
            padding-top: 70px;
            padding-bottom: 80px;
        }

        .marathi { font-family: 'Noto Sans Devanagari', sans-serif; }

        /* Universal Header */
        .top-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .lang-toggle {
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            font-size: 14px;
        }

        .profile-btn {
            width: 40px; height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            border: 2px solid white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        /* Universal Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--bg-white);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.75rem 0;
            border-top: 1px solid var(--border);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.5rem; margin-bottom: 4px; }

        .create-fab {
            width: 60px; height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            border: 4px solid var(--bg-white);
            transform: translateY(-20px);
            box-shadow: var(--shadow);
            text-decoration: none;
        }

        /* Feed Specific Styles */
        .feed {
            height: 100%;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .pull-indicator {
            text-align: center;
            padding: 1rem;
            color: var(--text-light);
            font-size: 0.9rem;
            display: none;
        }

        .story-post {
            background: var(--bg-white);
            margin: 1rem;
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }
        
        .post-header { padding: 1rem; display: flex; align-items: center; gap: 0.75rem; }
        .creator-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem; }
        .creator-info h4 { font-size: 0.9rem; margin-bottom: 0.25rem; }
        .creator-info span { font-size: 0.8rem; color: var(--text-light); }
        .post-options { margin-left: auto; color: var(--text-light); cursor: pointer; }
        .story-content { padding: 0 1rem 1rem; }
        .story-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .story-preview { font-size: 0.95rem; line-height: 1.6; color: var(--text-light); margin-bottom: 1rem; }
        .story-image { width: 100%; height: 200px; background: linear-gradient(135deg, var(--primary), #f7931e); border-radius: 12px; margin: 1rem 0; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white; }
        .story-actions { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-top: 1px solid var(--border); }
        .action-buttons { display: flex; gap: 1.5rem; }
        .action-btn { background: none; border: none; color: var(--text-light); cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: color 0.2s; }
        .action-btn:hover, .action-btn.active { color: var(--primary); }
        .choice-preview { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
        .choice-pill { background: var(--bg-light); padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; border: 1px solid var(--border); }

        /* Story Modal */
        .story-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-white); z-index: 1000; display: none; flex-direction: column; }
        .story-reader { flex: 1; overflow-y: auto; padding: 2rem 1rem; padding-top: 80px; }
        .reader-text { font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem; max-width: 600px; margin-left: auto; margin-right: auto; }
        .choice-options { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg-light); padding: 1rem; border-top: 1px solid var(--border); }
        .choice-btn { display: block; width: 100%; padding: 1rem; margin-bottom: 0.5rem; background: var(--bg-white); border: 1px solid var(--border); border-radius: 12px; color: var(--text-dark); text-align: left; cursor: pointer; transition: all 0.2s; }
        .choice-btn:hover { background: var(--primary); color: white; border-color: var(--primary);}
        
        .loading { display: flex; justify-content: center; align-items: center; padding: 2rem; color: var(--text-light); }
        .spinner { width: 24px; height: 24px; border: 2px solid var(--border); border-top: 2px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header class="top-bar">
        <h1 class="logo">kathaDragon</h1>
        <div class="header-actions">
            <div class="lang-toggle" id="lang-toggle-btn">मराठी</div>
            <a href="profile.html" class="profile-btn">U</a>
        </div>
    </header>

    <main class="feed" id="mainFeed">
        <div class="pull-indicator" id="pullIndicator">↓ Pull to refresh</div>
        <div class="loading"><div class="spinner"></div></div>
    </main>

    <div class="story-modal" id="storyModal">
        <div class="top-bar">
            <button style="background:none;border:none;color:var(--text-dark);font-size:1.5rem;cursor:pointer;" onclick="closeStoryReader()"><i class="fas fa-arrow-left"></i></button>
            <div id="story-progress-bar" style="flex:1;margin:0 1rem;background:var(--border);height:4px;border-radius:2px;">
                <div style="background:var(--primary);height:100%;width:33%;border-radius:2px;transition:width 0.3s;"></div>
            </div>
            <div id="story-progress-text" style="color:var(--text-light);font-size:0.9rem;">1/3</div>
        </div>
        <div class="story-reader" id="storyReader"></div>
        <div class="choice-options" id="choiceOptions"></div>
    </div>

    <nav class="bottom-nav">
        <a href="feed.html" class="nav-item active">
            <i class="fas fa-home"></i>
            <span class="nav-label" data-lang-mar="मुखपृष्ठ" data-lang-min="Home">मुखपृष्ठ</span>
        </a>
        <a href="discover.html" class="nav-item">
            <i class="fas fa-compass"></i>
            <span class="nav-label" data-lang-mar="शोधा" data-lang-min="Discover">शोधा</span>
        </a>
        <a href="create.html" class="create-fab"><i class="fas fa-plus"></i></a>
        <a href="community.html" class="nav-item">
            <i class="fas fa-users"></i>
            <span class="nav-label" data-lang-mar="समुदाय" data-lang-min="Community">समुदाय</span>
        </a>
        <a href="library.html" class="nav-item">
            <i class="fas fa-book-bookmark"></i>
            <span class="nav-label" data-lang-mar="ग्रंथालय" data-lang-min="Library">ग्रंथालय</span>
        </a>
    </nav>

    <script>
        // Data and State
        const feedData = [
             { id: 1, creator: "प्रिया पाटील", avatar: "P", time: "2 min ago", title: "The Midnight Choice", titleMr: "मध्यरात्रीची निवड", preview: "You're walking through old Pune's lanes when footsteps echo behind you. The clock strikes twelve...", previewMr: "जुन्या पुण्याच्या गल्ल्यांतून चालताना मागून पावलांचा आवाज येतो. बारा वाजतात...", thumbnail: "🌙", likes: 234, comments: 45, choices: ["Run", "Hide", "Confront"], choicesMr: ["पळा", "लपा", "सामना करा"], isLiked: false, isBookmarked: false },
             { id: 2, creator: "अमित शर्मा", avatar: "A", time: "5 min ago", title: "Mumbai Local Love", titleMr: "मुंबई लोकल प्रेम", preview: "Rush hour train, crowded compartment. Your eyes meet across the chaos...", previewMr: "रश अवरची ट्रेन, गर्दीचा डबा. गोंधळात डोळे भेटतात...", thumbnail: "🚂", likes: 189, comments: 32, choices: ["Smile", "Look away", "Move closer"], choicesMr: ["हसा", "नजर वळवा", "जवळ जा"], isLiked: true, isBookmarked: false },
             { id: 3, creator: "सुनीता देशमुख", avatar: "S", time: "12 min ago", title: "Ganpati's Secret", titleMr: "गणपतीचे रहस्य", preview: "The old Ganpati idol in your grandmother's house starts glowing during aarti...", previewMr: "आजीच्या घरातली जुनी गणपती मूर्ती आरतीच्या वेळी चमकू लागते...", thumbnail: "🙏", likes: 412, comments: 78, choices: ["Touch the idol", "Call family", "Keep watching"], choicesMr: ["मूर्तीला स्पर्श करा", "घरच्यांना बोलवा", "पाहत रहा"], isLiked: false, isBookmarked: true }
        ];
        let currentLanguage = 'mar'; // 'mar' for Marathi, 'min' for Minglish
        let currentStory = null;

        // Language Toggle Logic
        const langToggleBtn = document.getElementById('lang-toggle-btn');
        langToggleBtn.addEventListener('click', toggleLanguage);

        function toggleLanguage() {
            currentLanguage = (currentLanguage === 'mar') ? 'min' : 'mar';
            langToggleBtn.textContent = (currentLanguage === 'mar') ? 'English' : 'मराठी';
            
            document.querySelectorAll('[data-lang-mar]').forEach(el => {
                el.textContent = el.dataset[currentLanguage === 'mar' ? 'langMar' : 'langMin'];
            });
        }

        // Feed Loading Logic
        function loadFeed() {
            const feedContainer = document.getElementById('mainFeed');
            setTimeout(() => {
                feedContainer.innerHTML = feedData.map(story => `
                    <div class="story-post">
                        <div class="post-header">
                            <div class="creator-avatar">${story.avatar}</div>
                            <div class="creator-info">
                                <h4 class="marathi">${story.creator}</h4>
                                <span>${story.time}</span>
                            </div>
                            <div class="post-options"><i class="fas fa-ellipsis-h"></i></div>
                        </div>
                        <div class="story-content" onclick="readStory(${story.id})">
                            <h3 class="story-title marathi">${story.titleMr}</h3>
                            <p class="story-preview marathi">${story.previewMr}</p>
                            <div class="story-image">${story.thumbnail}</div>
                        </div>
                        <div class="story-actions">
                            <div class="action-buttons">
                                <button class="action-btn ${story.isLiked ? 'active' : ''}" onclick="toggleLike(event, ${story.id})"><i class="fas fa-heart"></i>&nbsp;${story.likes}</button>
                                <button class="action-btn" onclick="openComments(event, ${story.id})"><i class="fas fa-comment"></i>&nbsp;${story.comments}</button>
                                <button class="action-btn" onclick="shareStory(event, ${story.id})"><i class="fas fa-share"></i></button>
                            </div>
                            <button class="action-btn ${story.isBookmarked ? 'active' : ''}" onclick="toggleBookmark(event, ${story.id})"><i class="fas fa-bookmark"></i></button>
                        </div>
                    </div>
                `).join('');
                document.querySelector('.pull-indicator').style.display = 'none';
            }, 1000);
        }

        // Story Interaction Functions
        function readStory(storyId) {
            currentStory = feedData.find(s => s.id === storyId);
            const modal = document.getElementById('storyModal');
            document.getElementById('storyReader').innerHTML = `<div class="reader-text"><h2 class="marathi" style="margin-bottom:1rem;color:var(--primary);">${currentStory.titleMr}</h2><p class="marathi">${currentStory.previewMr}</p></div>`;
            document.getElementById('choiceOptions').innerHTML = currentStory.choicesMr.map((choice, index) => `<button class="choice-btn marathi" onclick="makeChoice(${index})">${choice}</button>`).join('');
            modal.style.display = 'flex';
        }
        
        function closeStoryReader() { document.getElementById('storyModal').style.display = 'none'; }
        
        function makeChoice(index) {
            const choiceContainer = document.getElementById('choiceOptions');
            choiceContainer.innerHTML = `<div style="text-align:center; padding: 1rem;"><h3 class="marathi" style="color:var(--primary); margin-bottom:1rem;">तुमची निवड नोंदवली!</h3><p class="marathi">कथेचा पुढील भाग लवकरच येत आहे...</p></div>`;
        }

        function toggleLike(event, storyId) {
            event.stopPropagation();
            const story = feedData.find(s => s.id === storyId);
            story.isLiked = !story.isLiked;
            story.likes += story.isLiked ? 1 : -1;
            loadFeed();
        }

        function toggleBookmark(event, storyId) {
            event.stopPropagation();
            const story = feedData.find(s => s.id === storyId);
            story.isBookmarked = !story.isBookmarked;
            loadFeed();
        }

        function openComments(event, storyId) { event.stopPropagation(); alert(`Opening comments for story ${storyId}`); }
        function shareStory(event, storyId) { event.stopPropagation(); alert(`Sharing story ${storyId}`); }

        // Pull to Refresh Logic
        function setupPullToRefresh() {
            const feed = document.getElementById('mainFeed');
            const indicator = document.getElementById('pullIndicator');
            let startY = 0; let pulling = false;

            feed.addEventListener('touchstart', (e) => {
                if (feed.scrollTop === 0) {
                    startY = e.touches[0].clientY;
                    pulling = true;
                    indicator.style.display = 'block';
                }
            });

            feed.addEventListener('touchend', () => {
                if (pulling && (event.changedTouches[0].clientY - startY > 100)) {
                    indicator.innerHTML = 'Refreshing...';
                    loadFeed();
                } else {
                   indicator.style.display = 'none';
                }
                pulling = false;
            });
        }
        
        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            loadFeed();
            setupPullToRefresh();
            toggleLanguage(); // Initialize to Minglish
        });
    </script>
</body>
</html>